const data = {
    accepted_currencies: [],
    investor_terms: {
        min_amount: 454,
        user_share: 0.11111,
    },
    investor_stages: [],
    lender_stages: [],
    packages: [],
    documents: [
        {
            id: 16,
            title: 'sdfsdf',
            isHidden: false,
            category: null,
            project: null,
            file: {
                id: 173,
                name: 'Снимок экрана 2022-04-18 в 21.25.39.png',
                alternativeText: null,
                caption: null,
                width: 1708,
                height: 702,
                formats: {
                    large: {
                        ext: '.png',
                        url: '/uploads/large_Snimok_ekrana_2022_04_18_v_21_25_39_e70096cabf.png',
                        hash: 'large_Snimok_ekrana_2022_04_18_v_21_25_39_e70096cabf',
                        mime: 'image/png',
                        name: 'large_Снимок экрана 2022-04-18 в 21.25.39.png',
                        path: null,
                        size: 197.6,
                        width: 1000,
                        height: 411,
                    },
                    small: {
                        ext: '.png',
                        url: '/uploads/small_Snimok_ekrana_2022_04_18_v_21_25_39_e70096cabf.png',
                        hash: 'small_Snimok_ekrana_2022_04_18_v_21_25_39_e70096cabf',
                        mime: 'image/png',
                        name: 'small_Снимок экрана 2022-04-18 в 21.25.39.png',
                        path: null,
                        size: 64.65,
                        width: 500,
                        height: 206,
                    },
                    medium: {
                        ext: '.png',
                        url: '/uploads/medium_Snimok_ekrana_2022_04_18_v_21_25_39_e70096cabf.png',
                        hash: 'medium_Snimok_ekrana_2022_04_18_v_21_25_39_e70096cabf',
                        mime: 'image/png',
                        name: 'medium_Снимок экрана 2022-04-18 в 21.25.39.png',
                        path: null,
                        size: 123.73,
                        width: 750,
                        height: 308,
                    },
                    thumbnail: {
                        ext: '.png',
                        url: '/uploads/thumbnail_Snimok_ekrana_2022_04_18_v_21_25_39_e70096cabf.png',
                        hash: 'thumbnail_Snimok_ekrana_2022_04_18_v_21_25_39_e70096cabf',
                        mime: 'image/png',
                        name: 'thumbnail_Снимок экрана 2022-04-18 в 21.25.39.png',
                        path: null,
                        size: 20.9,
                        width: 245,
                        height: 101,
                    },
                },
                hash: 'Snimok_ekrana_2022_04_18_v_21_25_39_e70096cabf',
                ext: '.png',
                mime: 'image/png',
                size: 87.81,
                url: '/uploads/Snimok_ekrana_2022_04_18_v_21_25_39_e70096cabf.png',
                previewUrl: null,
                provider: 'local',
                providerMetadata: null,
                createdAt: '2022-04-25T18:24:27.158Z',
                updatedAt: '2022-04-25T18:24:27.158Z',
            },
            cover: null,
        },
    ],
    title: '345345',
    description: '345345345',
    type: 'open',
    category: 1,
    status: 'active',
    starts_at: '',
    ends_at: '',
    fundraising_amount: 234345,
    initial_units: 34534,
    initial_unit_cost: 3430,
    roi: 455,
    fundraising_starts_at: '',
    fundraising_ends_at: '',
    funds_management_fee: 3,
    max_drawdown: 45,
    deposit_timing: 3,
    withdraw_delay: 4,
    auto_compound: false,
    special_terms: '',
    installments_enabled: false,
    publishedAt: 1650961793484,
};

const files = {
    covers: [
        {
            id: 174,
            name: 'Снимок экрана 2022-04-18 в 21.25.39.png',
            alternativeText: null,
            caption: null,
            width: 1708,
            height: 702,
            formats: {
                large: {
                    ext: '.png',
                    url: '/uploads/large_Snimok_ekrana_2022_04_18_v_21_25_39_2af21d6885.png',
                    hash: 'large_Snimok_ekrana_2022_04_18_v_21_25_39_2af21d6885',
                    mime: 'image/png',
                    name: 'large_Снимок экрана 2022-04-18 в 21.25.39.png',
                    path: null,
                    size: 197.6,
                    width: 1000,
                    height: 411,
                },
                small: {
                    ext: '.png',
                    url: '/uploads/small_Snimok_ekrana_2022_04_18_v_21_25_39_2af21d6885.png',
                    hash: 'small_Snimok_ekrana_2022_04_18_v_21_25_39_2af21d6885',
                    mime: 'image/png',
                    name: 'small_Снимок экрана 2022-04-18 в 21.25.39.png',
                    path: null,
                    size: 64.65,
                    width: 500,
                    height: 206,
                },
                medium: {
                    ext: '.png',
                    url: '/uploads/medium_Snimok_ekrana_2022_04_18_v_21_25_39_2af21d6885.png',
                    hash: 'medium_Snimok_ekrana_2022_04_18_v_21_25_39_2af21d6885',
                    mime: 'image/png',
                    name: 'medium_Снимок экрана 2022-04-18 в 21.25.39.png',
                    path: null,
                    size: 123.73,
                    width: 750,
                    height: 308,
                },
                thumbnail: {
                    ext: '.png',
                    url: '/uploads/thumbnail_Snimok_ekrana_2022_04_18_v_21_25_39_2af21d6885.png',
                    hash: 'thumbnail_Snimok_ekrana_2022_04_18_v_21_25_39_2af21d6885',
                    mime: 'image/png',
                    name: 'thumbnail_Снимок экрана 2022-04-18 в 21.25.39.png',
                    path: null,
                    size: 20.9,
                    width: 245,
                    height: 101,
                },
            },
            hash: 'Snimok_ekrana_2022_04_18_v_21_25_39_2af21d6885',
            ext: '.png',
            mime: 'image/png',
            size: 87.81,
            url: '/uploads/Snimok_ekrana_2022_04_18_v_21_25_39_2af21d6885.png',
            previewUrl: null,
            provider: 'local',
            providerMetadata: null,
            createdAt: '2022-04-25T19:29:15.553Z',
            updatedAt: '2022-04-25T19:29:15.553Z',
            related: [
                {
                    id: 130,
                    _Type: 'api::project.project',
                    title: '345345',
                    status: 'active',
                    type: 'open',
                    createdAt: '2022-04-25T17:55:50.670Z',
                    updatedAt: '2022-04-26T08:43:50.172Z',
                    publishedAt: '2022-04-26T08:42:17.361Z',
                    description: '345345345',
                    startsAt: null,
                    endsAt: null,
                    fundraisingAmount: 234345,
                    initialUnits: 34534,
                    initialUnitCost: 3430,
                    roi: 455,
                    fundraisingStartsAt: null,
                    fundraisingEndsAt: null,
                    fundsManagementFee: 3,
                    maxDrawdown: 45,
                    depositTiming: 3,
                    withdrawDelay: 4,
                    autoCompound: false,
                    specialTerms: null,
                    installmentsEnabled: false,
                },
            ],
        },
        {
            id: 175,
            name: 'Снимок экрана 2022-04-21 в 16.36.59.png',
            alternativeText: null,
            caption: null,
            width: 876,
            height: 804,
            formats: {
                small: {
                    ext: '.png',
                    url: '/uploads/small_Snimok_ekrana_2022_04_21_v_16_36_59_df8df61554.png',
                    hash: 'small_Snimok_ekrana_2022_04_21_v_16_36_59_df8df61554',
                    mime: 'image/png',
                    name: 'small_Снимок экрана 2022-04-21 в 16.36.59.png',
                    path: null,
                    size: 90.85,
                    width: 500,
                    height: 459,
                },
                medium: {
                    ext: '.png',
                    url: '/uploads/medium_Snimok_ekrana_2022_04_21_v_16_36_59_df8df61554.png',
                    hash: 'medium_Snimok_ekrana_2022_04_21_v_16_36_59_df8df61554',
                    mime: 'image/png',
                    name: 'medium_Снимок экрана 2022-04-21 в 16.36.59.png',
                    path: null,
                    size: 167.21,
                    width: 750,
                    height: 688,
                },
                thumbnail: {
                    ext: '.png',
                    url: '/uploads/thumbnail_Snimok_ekrana_2022_04_21_v_16_36_59_df8df61554.png',
                    hash: 'thumbnail_Snimok_ekrana_2022_04_21_v_16_36_59_df8df61554',
                    mime: 'image/png',
                    name: 'thumbnail_Снимок экрана 2022-04-21 в 16.36.59.png',
                    path: null,
                    size: 18.57,
                    width: 170,
                    height: 156,
                },
            },
            hash: 'Snimok_ekrana_2022_04_21_v_16_36_59_df8df61554',
            ext: '.png',
            mime: 'image/png',
            size: 30.7,
            url: '/uploads/Snimok_ekrana_2022_04_21_v_16_36_59_df8df61554.png',
            previewUrl: null,
            provider: 'local',
            providerMetadata: null,
            createdAt: '2022-04-25T19:29:15.552Z',
            updatedAt: '2022-04-25T19:29:15.552Z',
            related: [
                {
                    id: 130,
                    _Type: 'api::project.project',
                    title: '345345',
                    status: 'active',
                    type: 'open',
                    createdAt: '2022-04-25T17:55:50.670Z',
                    updatedAt: '2022-04-26T08:43:50.172Z',
                    publishedAt: '2022-04-26T08:42:17.361Z',
                    description: '345345345',
                    startsAt: null,
                    endsAt: null,
                    fundraisingAmount: 234345,
                    initialUnits: 34534,
                    initialUnitCost: 3430,
                    roi: 455,
                    fundraisingStartsAt: null,
                    fundraisingEndsAt: null,
                    fundsManagementFee: 3,
                    maxDrawdown: 45,
                    depositTiming: 3,
                    withdrawDelay: 4,
                    autoCompound: false,
                    specialTerms: null,
                    installmentsEnabled: false,
                },
            ],
        },
        {
            id: 176,
            name: 'Снимок экрана 2022-04-19 в 17.18.14.png',
            alternativeText: null,
            caption: null,
            width: 3360,
            height: 2052,
            formats: {
                large: {
                    ext: '.png',
                    url: '/uploads/large_Snimok_ekrana_2022_04_19_v_17_18_14_f4bc7594b1.png',
                    hash: 'large_Snimok_ekrana_2022_04_19_v_17_18_14_f4bc7594b1',
                    mime: 'image/png',
                    name: 'large_Снимок экрана 2022-04-19 в 17.18.14.png',
                    path: null,
                    size: 254.89,
                    width: 1000,
                    height: 611,
                },
                small: {
                    ext: '.png',
                    url: '/uploads/small_Snimok_ekrana_2022_04_19_v_17_18_14_f4bc7594b1.png',
                    hash: 'small_Snimok_ekrana_2022_04_19_v_17_18_14_f4bc7594b1',
                    mime: 'image/png',
                    name: 'small_Снимок экрана 2022-04-19 в 17.18.14.png',
                    path: null,
                    size: 90.77,
                    width: 500,
                    height: 305,
                },
                medium: {
                    ext: '.png',
                    url: '/uploads/medium_Snimok_ekrana_2022_04_19_v_17_18_14_f4bc7594b1.png',
                    hash: 'medium_Snimok_ekrana_2022_04_19_v_17_18_14_f4bc7594b1',
                    mime: 'image/png',
                    name: 'medium_Снимок экрана 2022-04-19 в 17.18.14.png',
                    path: null,
                    size: 166.17,
                    width: 750,
                    height: 458,
                },
                thumbnail: {
                    ext: '.png',
                    url: '/uploads/thumbnail_Snimok_ekrana_2022_04_19_v_17_18_14_f4bc7594b1.png',
                    hash: 'thumbnail_Snimok_ekrana_2022_04_19_v_17_18_14_f4bc7594b1',
                    mime: 'image/png',
                    name: 'thumbnail_Снимок экрана 2022-04-19 в 17.18.14.png',
                    path: null,
                    size: 30.52,
                    width: 245,
                    height: 150,
                },
            },
            hash: 'Snimok_ekrana_2022_04_19_v_17_18_14_f4bc7594b1',
            ext: '.png',
            mime: 'image/png',
            size: 222.05,
            url: '/uploads/Snimok_ekrana_2022_04_19_v_17_18_14_f4bc7594b1.png',
            previewUrl: null,
            provider: 'local',
            providerMetadata: null,
            createdAt: '2022-04-25T19:29:15.574Z',
            updatedAt: '2022-04-25T19:29:15.574Z',
            related: [
                {
                    id: 130,
                    _Type: 'api::project.project',
                    title: '345345',
                    status: 'active',
                    type: 'open',
                    createdAt: '2022-04-25T17:55:50.670Z',
                    updatedAt: '2022-04-26T08:43:50.172Z',
                    publishedAt: '2022-04-26T08:42:17.361Z',
                    description: '345345345',
                    startsAt: null,
                    endsAt: null,
                    fundraisingAmount: 234345,
                    initialUnits: 34534,
                    initialUnitCost: 3430,
                    roi: 455,
                    fundraisingStartsAt: null,
                    fundraisingEndsAt: null,
                    fundsManagementFee: 3,
                    maxDrawdown: 45,
                    depositTiming: 3,
                    withdrawDelay: 4,
                    autoCompound: false,
                    specialTerms: null,
                    installmentsEnabled: false,
                },
            ],
        },
    ],
    'documents[0].file': {
        id: 173,
        name: 'Снимок экрана 2022-04-18 в 21.25.39.png',
        alternativeText: null,
        caption: null,
        width: 1708,
        height: 702,
        formats: {
            large: {
                ext: '.png',
                url: '/uploads/large_Snimok_ekrana_2022_04_18_v_21_25_39_e70096cabf.png',
                hash: 'large_Snimok_ekrana_2022_04_18_v_21_25_39_e70096cabf',
                mime: 'image/png',
                name: 'large_Снимок экрана 2022-04-18 в 21.25.39.png',
                path: null,
                size: 197.6,
                width: 1000,
                height: 411,
            },
            small: {
                ext: '.png',
                url: '/uploads/small_Snimok_ekrana_2022_04_18_v_21_25_39_e70096cabf.png',
                hash: 'small_Snimok_ekrana_2022_04_18_v_21_25_39_e70096cabf',
                mime: 'image/png',
                name: 'small_Снимок экрана 2022-04-18 в 21.25.39.png',
                path: null,
                size: 64.65,
                width: 500,
                height: 206,
            },
            medium: {
                ext: '.png',
                url: '/uploads/medium_Snimok_ekrana_2022_04_18_v_21_25_39_e70096cabf.png',
                hash: 'medium_Snimok_ekrana_2022_04_18_v_21_25_39_e70096cabf',
                mime: 'image/png',
                name: 'medium_Снимок экрана 2022-04-18 в 21.25.39.png',
                path: null,
                size: 123.73,
                width: 750,
                height: 308,
            },
            thumbnail: {
                ext: '.png',
                url: '/uploads/thumbnail_Snimok_ekrana_2022_04_18_v_21_25_39_e70096cabf.png',
                hash: 'thumbnail_Snimok_ekrana_2022_04_18_v_21_25_39_e70096cabf',
                mime: 'image/png',
                name: 'thumbnail_Снимок экрана 2022-04-18 в 21.25.39.png',
                path: null,
                size: 20.9,
                width: 245,
                height: 101,
            },
        },
        hash: 'Snimok_ekrana_2022_04_18_v_21_25_39_e70096cabf',
        ext: '.png',
        mime: 'image/png',
        size: 87.81,
        url: '/uploads/Snimok_ekrana_2022_04_18_v_21_25_39_e70096cabf.png',
        previewUrl: null,
        provider: 'local',
        providerMetadata: null,
        createdAt: '2022-04-25T18:24:27.158Z',
        updatedAt: '2022-04-25T18:24:27.158Z',
    },
};

const removeFilesKeysFromData = ({ data, files, dataKey, index }) => {
    data;
    files;
    dataKey;

    let modified = {};
    for (const key in data) {
        key;
        data[key];
        if (typeof data[key] !== 'object' || data[key] === null) {
            data[key];
            modified[key] = data[key];
        }
        // console.log(`🚀 ~ removeFilesKeysFromData ~ data`, data, files);
        if (Array.isArray(data[key])) {
            key;
            modified[key] = data[key].map((item, index) =>
                removeFilesKeysFromData({ data: item, files, dataKey: `${key}[${index}]`, index })
            );
            if (modified[key].length && modified[key][0]?.ext) {
                delete modified[key];
            }
            console.log(`🚀 ~ removeFilesKeysFromData ~ data[key]`, key, data[key], files);
        }
        if (typeof data[key] === 'object') {
            if (dataKey) {
                dataKey;
                key;
                `${dataKey}${key}`;
                // stages[0].icon;
                if (Object.keys(files).includes(`${dataKey}.${key}`)) {
                    Object.keys(files);
                    delete modified[key];
                }
                Object.keys(files);
            }
            if (data[key]?.ext) {
                delete modified[key];
            }
            modified[key];
            // .includes(`${dataKey}${key}`);
        }
    }
    // console.log(`🚀 ~ removeFilesKeysFromData ~ data, files`, data, files);
    return modified;
};

const clearFields = ({ data, dataKey, files }) => {
    let modified;
    dataKey;
    if (typeof data === 'object') {
        modified = {};
        if (Array.isArray(data)) {
            modified = [];
            dataKey;
            files;
            for (const [index, element] of data.entries()) {
                element;
                index;
                `${dataKey}[${index}]`;
                modified.push(clearFields({ data: element, files }));
            }
        } else {
            let isFile = Object.keys(data).filter((key) => {
                data[key]; //?
            });
            for (const key of Object.keys(data)) {
                key;
                if (data[key] === '' || data[key] === null) {
                    continue;
                }
                data[key];
                // если это не файл
                if (!data[key]?.ext) {
                    modified[key] = clearFields({ data: data[key], dataKey: key, files });
                }
            }
        }
    } else {
        modified = data;
    }
    return modified;
};

const oldData = {
    id: 62,
    createdAt: '2022-05-15T12:03:01.379Z',
    updatedAt: '2022-05-15T14:28:37.448Z',
    publishedAt: '2022-05-15T12:03:01.289Z',
    invest_unit_price: 10000,
    is_history: false,
    installments_enabled: true,
    project_credential_index: 0,
    contract_was_readed: false,
    is_investor: true,
    units: '20',
    invested_at: '2022-05-14T22:11:00.000Z',
    user: {
        id: 7,
        username: 'finmajor@finmajor.ru',
        email: 'finmajor@finmajor.ru',
        provider: 'local',
        password: '$2a$10$eqxn7ddpGP1xeKB91kG8CecG2x8TnhhtU45MjCfZzzklQJesPvLhC',
        resetPasswordToken: null,
        confirmationToken: null,
        confirmed: true,
        blocked: false,
        createdAt: '2022-05-03T14:09:07.513Z',
        updatedAt: '2022-05-09T12:41:28.596Z',
        phone_number: '+79312788449',
        name: 'Финмажор',
        phone_number_confirmed: true,
        phoneNumberConfirmationToken: null,
        otp_secret: null,
    },
    project: {
        id: 130,
        title: 'Название проекта 130',
        status: 'active',
        type: 'close',
        createdAt: '2022-04-25T17:55:50.670Z',
        updatedAt: '2022-05-15T12:18:01.983Z',
        publishedAt: '2022-05-15T10:20:11.718Z',
        description: 'О проекте',
        starts_at: '2022-04-28',
        ends_at: '2022-04-30',
        fundraising_amount: '1000000',
        initial_units: 100,
        roi: 45,
        fundraising_starts_at: '2022-04-28',
        fundraising_ends_at: '2022-04-30',
        funds_management_fee: 3,
        max_drawdown: 45,
        deposit_timing: 3,
        withdraw_delay: 4,
        auto_compound: true,
        special_terms: 'Особые условия',
        installments_enabled: true,
        initial_unit_price: 10000,
    },
    investor_terms: {
        id: 174,
        min_amount: '50000',
        user_share: 1,
    },
    lender_terms: {
        id: 175,
        min_amount: '60000',
        user_share: 2,
    },
    investment_stages: [
        {
            id: 104,
            units: 13,
            stage_index: 0,
        },
        {
            id: 105,
            units: 13,
            stage_index: 1,
        },
        {
            id: 106,
            units: 12,
            stage_index: 2,
        },
    ],
    currency: {
        id: 1,
        title: 'rub',
        symbol: 'rub',
        type: 'fiat',
        createdAt: '2022-04-25T05:07:06.702Z',
        updatedAt: '2022-04-29T10:16:08.876Z',
        publishedAt: '2022-04-25T05:07:11.147Z',
        unicode: '₽',
    },
    contracts: [
        {
            id: 16,
            is_signed: true,
            was_readed: false,
        },
    ],
    createdBy: null,
    updatedBy: {
        id: 1,
        firstname: 'finmajor',
        lastname: 'finmajor',
        username: 'finmajor',
        email: 'finmajor@finmajor.com',
        password: '$2a$10$n7rcBersbnI3pZ.XV7zlmO75eO.e0PzSg7TX9YK4qcXwtln1Y2C2G',
        resetPasswordToken: null,
        registrationToken: null,
        isActive: true,
        blocked: false,
        preferedLanguage: null,
        createdAt: '2022-04-14T23:46:35.076Z',
        updatedAt: '2022-05-11T12:38:30.079Z',
    },
};

const sanitizeDataForClone = ({ data, keysForIds = [] }) => {
    const sanitized = {};
    for (const entry of Object.entries(data)) {
        entry;
        if (entry[0] !== 'id') {
            if (typeof entry[1] === 'object' && entry[1] !== null) {
                if (keysForIds.includes(entry[0])) {
                    sanitized[entry[0]] = entry[1].id;
                    continue;
                }
                if (Array.isArray(entry[1])) {
                    sanitized[entry[0]] = [];
                    for (const entryItem of entry[1]) {
                        sanitized[entry[0]].push(sanitizeDataForClone({ data: entryItem }));
                    }
                } else {
                    sanitized[entry[0]] = sanitizeDataForClone({ data: entry[1] });
                }
            } else {
                sanitized[entry[0]] = entry[1];
            }
        }
    }
    return sanitized;
};

const res = sanitizeDataForClone({ data: oldData, keysForIds: ['user', 'project', 'currency'] });
